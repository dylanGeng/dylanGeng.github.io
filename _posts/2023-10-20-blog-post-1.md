---
title: 'Presburger Arithmetic in MLIR'
date: 2023-10-20
permalink: /posts/2023/10/blog-post-1/
tags:
  - MLIR
  - Affine Dialect
  - Presburger Arithmetic
---

Presburger arithmetic provides the mathematical core for the polyhedral compilation techniques that drive analytical cache models, loop optimization for ML and HPC, formal verification, and hardware design. Arjun Pitchanathan, Kunwar Shaanjeet Singh Grover, Michel Weber and Tobias Grosser develop FPL, a fast new Presburger library, worked with the LLVM community to make Presburger arithmetic an integral part of the production-focused MLIR compiler framework.

With FPL now a native, performant, and approachable component of the LLVM ecosystem, compiler developers can co-develop the Presburger library and polyhedral transformations with ease. Expect that more scientists and compiler engineers will be able to jointly develop even more IMPACTful polyhedral optimizations.

Introduction
======

Polyhedral compilation based on Presburger arithmetic is used for performance optimization in high-performance computing and machine learning, formal verification, cache modeling, the derivation of data movement bounds, and configurable computing. 

Over the last thirty years, several libraries provided mathematical foundations for polyhedral compilation. Omega and Polylib, developed many of the early ideas and inspired the design of polyhedral math libraries. The Parma Polyhedral Library (PPL) was the first polyhedral library to be used in GCC, as part of the Graphite; isl further improved on its robustness, provided the foundations for LLVM/Polly and Tensor Comprehensions, among others, and is considered state-of-the-art in polyhedral libraries. Finally, VPL demonstrated formally verified implementations for certain operations on sets of rationals.

As a Presburger library for LLVM/Polly, GCC, and many other tools, isl outgrew its mathematical roots quickly and increasingly incorporated broader compiler concepts. In particular, isl offered code generation facilities as well as higher-level code representations such as schedule trees. While schedule trees made polyhedral compilers more powerful, they were incompatible with the design and needs of LLVM. MLIR then generalized schedule trees with nested regions, and used these with the Affine dialect to create a simplified loop model that integrates well with the broader LLVM ecosystem. Until now it was necessary to choose between a well-integrated simple loop optimizer and full polyhedral transformations that translate MLIR dialects into isl-compatible formats. Unfortunately, the conversion costs and community disconnects hindered deeper integration of such approaches into MLIR.

With a generalization of schedule trees available in MLIR, the last missing piece is a fast and compute library for Presburger arithmetic. We fill in this gap by contributing a Presburger library, FPL, to LLVM. FPL was written from the ground up to meet the community's standards, incentivizing further participation in the development of these mathematical foundations and allowing for the polyhedral compiler to be co-developed with the Presburger library.

MLIR API
======

Use Example
------